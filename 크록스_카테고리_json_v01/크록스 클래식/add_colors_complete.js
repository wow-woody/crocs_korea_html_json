const fs = require('fs');

// JSON 파일 읽기 (수동으로 BOM 제거)
let jsonContent = fs.readFileSync('./crocs_products_신상품.json', 'utf8');
// BOM 제거
if (jsonContent.charCodeAt(0) === 0xFEFF) {
    jsonContent = jsonContent.slice(1);
}

// HTML 파일에서 각 상품별 색상 정보를 수동으로 매핑
// 상품 ID별 색상 정보 (HTML에서 확인된 내용 기반)
const colorMapping = {
    "212106": ["rgb(0, 0, 0)", "rgb(26, 24, 21)", "rgb(150, 105, 74)"], // 클래식 언퍼게터블 스웨이드 클로그
    "211979": [], // 클래식 퍼프 스트랩 라인드 클로그
    "211684": [], // M&Ms x 크록스 클래식 클로그
    "212260": [], // M&Ms x 크록스 베이 클로그
    "211768": ["rgb(0, 0, 0)", "rgb(82, 48, 27)"], // 버터 x 크록스 클래식 클로그
    "211116": ["rgb(0, 0, 0)"], // 클래식 언퍼게터블 클로그
    "211396": ["rgb(60, 65, 120)"], // 클래식 플리스 라인드 클로그(플리스 스트랩)
    "212854": [], // 클래식 플랫폼 퍼즈 라인드 클로그
    "211767": ["rgb(0, 0, 0)"], // 장 폴 고티에 x 크록스 클래식 클로그
    "212074": [], // 기묘한 이야기 클래식 클로그
    "211892": [], // 클래식 이매지네이션 라이트 백스트랩 클로그 토들러
    "211751": [], // 주토피아 라인드 플랫폼 클로그
    "211750": [], // 주토피아 클래식 클로그 키즈
    "211749": [], // 주토피아 클래식 클로그
    "211692": [], // 도라에몽 클래식 클로그 키즈
    "211691": [], // 도라에몽 클래식 클로그
    "211507": [], // 기묘한 이야기 헬파이어 클래식 클로그
    "211082": ["rgb(0, 0, 0)"], // 장 폴 고티에 x 크록스 베이 클로그
    "211806": [], // 리얼트리 APX 에코 RO 클로그
    "211928": [], // 클래식 퍼즈 라인드 글리터 클로그
    "212770": [], // 딜런 플랫폼 라인드 클로그
    "211919": [], // 베이 벨벳 클로그
    "211753": [], // 베이 라인드 클로그
    "211766": ["rgb(0, 0, 0)", "rgb(160, 21, 51)"], // 장 폴 고티에 x 크록스 하이드라 클로그
    "210814": [], // 미키 크리스마스 라인드 클래식 클로그 키즈
    "212001": [], // 클래식 언퍼게터블 카모 클로그
    "211980": [], // 클래식 퍼프 스트랩 마블 라인드 클로그
    "212242": [], // 디즈니 앤 픽사 랏소 클래식 클로그 토들러
    "211886": [], // 클래식 보우 클로그 키즈
    "212240": [], // 디즈니 앤 픽사 랏소 클래식 플랫폼 클로그 우먼
    "212097": ["rgb(0, 0, 0)"], // 클래식 스웨이드 모크
    "212095": [], // 에코 카모 RO 클로그
    "211380": [], // 클래식 라인드 쇼티
    "211361": [], // 에코 RO 립스탑 클로그
    "212241": [], // 디즈니 앤 픽사 랏소 클래식 클로그 키즈
    "211636": [], // 클래식 라인드 외계인 클로그 키즈
    "211635": [], // 클래식 라인드 데이지 클로그 토들러
    "211483": [], // 미키 앤 미니 클래식 클로그
    "211131": ["rgb(0, 0, 0)"], // 슈퍼맨 클래식 클로그
    "212416": [], // 클래식 언퍼게터블 레오파드 클로그
    "212386": [], // 클래식 언퍼게터블 레오파드 부츠
    "211988": [], // 클래식 썸머 데님 클로그
    "211984": ["rgb(0, 0, 0)"], // 에코 마블 파우치 클로그
    "211978": [], // 베이 웨딩 글리터 클로그
    "211811": [], // 에코 워터컬러 마블 웨이브
    "211758": [], // 디즈니 앤 픽사 랏소 클래식 라인드 클로그
    "211634": [], // 클래식 라인드 데이지 클로그 키즈
    "211609": [], // 클래식 스타 스파클 셰이커 클로그 키즈
    "211535": [], // 클래식 디지털 카모 클로그
    "211492": [], // 쿠로미™ 클래식 클로그 키즈
    "211491": [], // 쿠로미™ 클래식 클로그
    "211485": [], // 미키 앤 프렌즈 클래식 클로그 토들러
    "211482": [], // 미키 앤 프렌즈 클래식 클로그
    "211414": ["rgb(0, 0, 0)"], // 고스트버스터즈™ 클래식 클로그
    "211412": [], // 귀멸의 칼날 시노부 클래식 클로그
    "211132": ["rgb(0, 0, 0)"], // 슈퍼맨 클래식 클로그 키즈
    "210113": [], // 동물의 숲 클래식 클로그 키즈
    "210101": [], // 동물의 숲 플랫폼 클로그
    "209320": [], // 귀멸의 칼날 네즈코 클래식 클로그
    "213226": [] // 클래식 마블 클로그 파우치 백 참
};

try {
    const jsonData = JSON.parse(jsonContent);
    
    // 각 상품에 색상 정보 추가
    jsonData.products_new.forEach((product, index) => {
        const productId = product["상품 ID"];
        const colors = colorMapping[productId] || [];
        
        // 새로운 객체 생성하여 순서 유지
        const newProduct = {};
        Object.keys(product).forEach(key => {
            newProduct[key] = product[key];
            if (key === "상품명") {
                newProduct["색상"] = colors;
            }
        });
        jsonData.products_new[index] = newProduct;
    });
    
    // 업데이트된 JSON 파일 저장
    fs.writeFileSync('./crocs_products_신상품_updated.json', JSON.stringify(jsonData, null, 4), 'utf8');
    
    console.log('색상 정보가 추가된 JSON 파일이 생성되었습니다: crocs_products_신상품_updated.json');
    
    // 색상이 있는 상품들 확인
    jsonData.products_new.forEach(product => {
        if (product["색상"] && product["색상"].length > 0) {
            console.log(`상품 ID ${product["상품 ID"]} (${product["상품명"]}): ${product["색상"].join(', ')}`);
        }
    });
    
} catch (error) {
    console.error('JSON 파싱 에러:', error);
}